<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Baudot AFSK Generator</title>
  <style>
    body { font-family: sans-serif; background: #111; color: #ddd; padding: 1em; }
    input, select, button, textarea { margin: 0.5em 0; width: 100%; }
    textarea { height: 6em; font-family: monospace; background: #222; color: #0f0; }
    #typingDisplay { font-family: monospace; white-space: pre; background: #000; color: #0f0; padding: 0.5em; height: 6em; overflow-y: auto; border: 1px solid #444; }
  </style>
</head>
<body>
 <h2>TTY ART AFSK GENERATOR</h2>
<p style="margin-top: 0.2em; font-size: 0.9em; color: #aaa;">Upload an image or type text to convert it into teletype-compatible AFSK audio. Configure image filters and audio parameters as needed, then preview and download the generated WAV.</p>

  <label>Character Set (for image):</label>
  <select id="asciiRamp">
    <option value=" #O.-">BOLD:#O.-</option>
    <option value=" @#O=-.">SHADED:@#O=-</option>
    <option value=" #XO.">TIGHT:#XO.</option>
    <option value="#MW$%|=+:-. ">ASCII:#MW$%|=+:-.</option>
    <option value="custom">CUSTOM (see below)</option>
  </select><br>

  <label>Custom Character Set:</label>
  <input type="text" id="customRamp" value="@#=+:. "><br>

  <label>Brightness (0.5 = normal):</label>
  <input type="number" step="0.1" id="brightness" value="0.5"><br>

  <label>Contrast (1 = normal):</label>
  <input type="number" step="0.1" id="contrast" value="1.0"><br>

  <label>Threshold (0 = grayscale, 255 = pure black/white):</label>
  <input type="number" min="0" max="255" id="threshold" value="0"><br>

  <div style="margin-top:0.5em; display: flex; flex-direction: column; gap: 0.2em; align-items: flex-start;">
    <label><input type="checkbox" id="invert"> Invert image</label>
    <label><input type="checkbox" id="dither"> Apply dithering</label>
  </div>

  <label>ASCII Width (characters):</label>
  <input type="number" id="asciiWidth" value="72" min="10" max="200"><br>

  <label>Select Image:</label>
  <input type="file" id="imageInput" accept="image/*"><br>

  <button onclick="generateASCII()" style="background-color:#0f0; color:#000; font-weight:bold; border:2px solid #0c0;">Convert Image</button>

  <textarea id="asciiOutput"></textarea>
  <audio id="asciiAudioPlayer" controls style="display:block; margin-top:1em;"></audio>

  <label>OR enter text below:</label>
  <textarea id="textInput">HELLO WORLD</textarea>

  <label>Baud Rate:</label>
  <input type="number" id="baudRate" value="45.45">

  <label>Mark Frequency (Hz):</label>
  <input type="number" id="markFreq" value="2125">

  <label>Space Frequency (Hz):</label>
  <input type="number" id="spaceFreq" value="2295">

  <label>Stop Bits:</label>
  <input type="number" step="0.1" id="stopBits" value="1.5">

  <button onclick="generateWavAFSK()" style="background-color:#0f0; color:#000; font-weight:bold; border:2px solid #0c0;">Generate AFSK WAV</button>
  <audio id="audioPlayer" controls style="display:block; margin-top:1em;"></audio>

  <canvas id="asciiCanvas" style="display:none"></canvas>

  <script>
function generateASCII() {
  const imageInput = document.getElementById('imageInput');
  const canvas = document.getElementById('asciiCanvas');
  const ctx = canvas.getContext('2d');
  const asciiOutput = document.getElementById('asciiOutput');

  if (!imageInput.files.length) return alert('Please select an image');

  const file = imageInput.files[0];
  const reader = new FileReader();

  reader.onload = function (e) {
    const img = new Image();
    img.onload = function () {
      const width = parseInt(document.getElementById('asciiWidth').value);
      const scale = width / img.width;
      const height = Math.floor(img.height * scale);
      canvas.width = width;
      canvas.height = height;

      ctx.drawImage(img, 0, 0, width, height);
      const imageData = ctx.getImageData(0, 0, width, height).data;

      const ramp = (document.getElementById('asciiRamp').value === 'custom')
        ? document.getElementById('customRamp').value
        : document.getElementById('asciiRamp').value;

      let ascii = '';
      for (let y = 0; y < height; y++) {
        for (let x = 0; x < width; x++) {
          const idx = (y * width + x) * 4;
          const avg = (imageData[idx] + imageData[idx + 1] + imageData[idx + 2]) / 3;
          const charIdx = Math.floor((avg / 255) * (ramp.length - 1));
          ascii += ramp.charAt(ramp.length - 1 - charIdx);
        }
        ascii += "\n";
      }

      asciiOutput.value = ascii;
    };
    img.src = e.target.result;
  };

  reader.readAsDataURL(file);
}
  </script>
</body>
</html>
